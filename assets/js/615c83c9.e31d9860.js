"use strict";(self.webpackChunkkai_dev=self.webpackChunkkai_dev||[]).push([[8562],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>f});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},d=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,l=e.originalType,s=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),p=c(n),m=o,f=p["".concat(s,".").concat(m)]||p[m]||u[m]||l;return n?r.createElement(f,a(a({ref:t},d),{},{components:n})):r.createElement(f,a({ref:t},d))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var l=n.length,a=new Array(l);a[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[p]="string"==typeof e?e:o,a[1]=i;for(var c=2;c<l;c++)a[c]=n[c];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},2085:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var r=n(7462),o=(n(7294),n(3905));const l={sidebar_position:1,description:"\u4e00\u76f4\u90fd\u4e0d\u592a\u4e86\u89e3 React \u7684 StrictMode \u7684\u7528\u610f\uff0c\u9019\u6b21\u5c31\u4f86\u597d\u597d\u4e86\u89e3\u5b83"},a="StrictMode",i={unversionedId:"React/StrictMode",id:"React/StrictMode",title:"StrictMode",description:"\u4e00\u76f4\u90fd\u4e0d\u592a\u4e86\u89e3 React \u7684 StrictMode \u7684\u7528\u610f\uff0c\u9019\u6b21\u5c31\u4f86\u597d\u597d\u4e86\u89e3\u5b83",source:"@site/docs/React/StrictMode.md",sourceDirName:"React",slug:"/React/StrictMode",permalink:"/docs/React/StrictMode",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,description:"\u4e00\u76f4\u90fd\u4e0d\u592a\u4e86\u89e3 React \u7684 StrictMode \u7684\u7528\u610f\uff0c\u9019\u6b21\u5c31\u4f86\u597d\u597d\u4e86\u89e3\u5b83"},sidebar:"tutorialSidebar",previous:{title:"React",permalink:"/docs/category/react"},next:{title:"Profiler",permalink:"/docs/React/Profiler"}},s={},c=[{value:"\u524d\u8a00",id:"\u524d\u8a00",level:2},{value:"\u7279\u6027",id:"\u7279\u6027",level:3},{value:"\u6aa2\u67e5\u9805\u76ee",id:"\u6aa2\u67e5\u9805\u76ee",level:3},{value:"\u6ce8\u610f\u4e8b\u9805",id:"\u6ce8\u610f\u4e8b\u9805",level:3},{value:"\u7528\u6cd5",id:"\u7528\u6cd5",level:2},{value:"\u5075\u932f\u6848\u4f8b",id:"\u5075\u932f\u6848\u4f8b",level:2},{value:"Re-render component to find bugs and fixed",id:"re-render-component-to-find-bugs-and-fixed",level:3},{value:"Re-run effect to find bugs and fixed",id:"re-run-effect-to-find-bugs-and-fixed",level:3},{value:"Find deprecation warnings enabled",id:"find-deprecation-warnings-enabled",level:3},{value:"\u89e3\u6c7a useEffect \u6703 call \u5169\u6b21 API \u7684\u554f\u984c",id:"\u89e3\u6c7a-useeffect-\u6703-call-\u5169\u6b21-api-\u7684\u554f\u984c",level:2},{value:"Remove StrictMode",id:"remove-strictmode",level:3},{value:"Use AbortController",id:"use-abortcontroller",level:3},{value:"Use React-Query",id:"use-react-query",level:3}],d={toc:c},p="wrapper";function u(e){let{components:t,...l}=e;return(0,o.kt)(p,(0,r.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"strictmode"},"StrictMode"),(0,o.kt)("p",null,"\u53c3\u8003\u8cc7\u6599\uff1a"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://react.dev/reference/react/StrictMode#fixing-deprecation-warnings-enabled-by-strict-mode"},"React Document: StrictMode")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://translate.google.com.tw/?hl=zh-TW&sl=en&tl=zh-TW&text=React%2018%20useEffect%20Double%20Call%20for%20APIs%3A%20Emergency%20Fix&op=translate"},"React 18 useEffect Double Call for APIs: Emergency Fix")),(0,o.kt)("h2",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,o.kt)("p",null,"\u5728\u958b\u767c\u6642\uff0c\u6709\u6642\u5019\u6703\u767c\u73fe useEffect \u6703\u5728\u7b2c\u4e00\u6b21 render \u6642\uff0c\u88ab\u89f8\u767c\u5169\u6b21\uff0c\u4e0a stack overflow \u627e\uff0c\u5927\u90e8\u5206\u90fd\u6703\u8aaa\u628a\u5305\u5728\u5916\u5c64\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"<React.StrictMode></React.StrictMode>")," \u62ff\u6389\uff0c\u4f46\u4e26\u4e0d\u4e86\u89e3\u70ba\u4ec0\u9ebc\u9019\u6a23\u5c31\u53ef\u4ee5\u6b63\u5e38\u958b\u767c\uff0c\u9019\u6b21\u5c31\u4f86\u77ad\u89e3\u9019\u500b Components \u7684\u7279\u6027\u8207\u4f7f\u7528\u6642\u6a5f\u3002"),(0,o.kt)("h3",{id:"\u7279\u6027"},"\u7279\u6027"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"React 18 \u4e4b\u5f8c\u624d\u6709\u7684 future"),(0,o.kt)("li",{parentName:"ul"},"\u7528\u9014\u5728\u65bc\u53ef\u4ee5\u53ca\u65e9\u767c\u73fe\u932f\u8aa4"),(0,o.kt)("li",{parentName:"ul"},"\u50c5\u5728\u958b\u767c\u6a21\u5f0f\u4e0b\u6709\u7528\uff08Prod \u4e0d\u53d7\u5f71\u97ff\uff09")),(0,o.kt)("h3",{id:"\u6aa2\u67e5\u9805\u76ee"},"\u6aa2\u67e5\u9805\u76ee"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"re-render component: \u6aa2\u67e5 render \u662f\u5426\u662f pure \u7684"),(0,o.kt)("li",{parentName:"ul"},"re-run effect: \u6aa2\u67e5 effect \u88e1\u9762\u662f\u5426\u662f pure \u7684"),(0,o.kt)("li",{parentName:"ul"},"checked usage api: \u6aa2\u67e5\u662f\u5426\u6709\u4f7f\u7528\u5df2\u7d93\u68c4\u7528\u7684 React API")),(0,o.kt)("h3",{id:"\u6ce8\u610f\u4e8b\u9805"},"\u6ce8\u610f\u4e8b\u9805"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u6c92\u6709 props \u7684\u53c3\u6578"),(0,o.kt)("li",{parentName:"ul"},"\u56e0\u70ba\u6c92\u6709 props \u7684\u53c3\u6578\uff0c\u6240\u4ee5\u4e0d\u80fd\u900f\u904e props \u52d5\u614b\u6c7a\u5b9a\u662f\u5426\u8981\u555f\u7528 StrictMode \uff0c\u6240\u4ee5\u7576\u5718\u968a\u958b\u767c\u5b8c\uff0c\u53ef\u4ee5\u6c7a\u5b9a\u662f\u5426\u8981\u5728\u958b\u767c\u74b0\u5883\u79fb\u9664 StrictMode \u6216\u662f\u5c07 StrictMode \u79fb\u52d5\u5230\u9700\u8981\u7684 Component \u5916\u5c64\u5c31\u597d")),(0,o.kt)("h2",{id:"\u7528\u6cd5"},"\u7528\u6cd5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u5305\u5728\u6574\u500b APP \u5916\u5c64"',title:'"\u5305\u5728\u6574\u500b',APP:!0,'\u5916\u5c64"':!0},'import {StrictMode} from "react";\nimport {createRoot} from "react-dom/client";\n\nconst root = createRoot(document.getElementById("root"));\nroot.render(\n  <StrictMode>\n    <App />\n  </StrictMode>\n);\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u5305\u5728\u5404\u5225 Component \u5916\u9762"',title:'"\u5305\u5728\u5404\u5225',Component:!0,'\u5916\u9762"':!0},'import {StrictMode} from "react";\n\nexport default function Layout() {\n  return (\n    <main>\n      <StrictMode>\n        <Button />\n      </StrictMode>\n      <StrictMode>\n        <Navbar />\n      </StrictMode>\n    </main>\n  );\n}\n')),(0,o.kt)("h2",{id:"\u5075\u932f\u6848\u4f8b"},"\u5075\u932f\u6848\u4f8b"),(0,o.kt)("p",null,"\u4ee5\u4e0b\u6848\u4f8b\u90fd\u5f9e\u6587\u4ef6\u53c3\u8003\u4e26\u89e3\u8aaa\uff0c\u8a73\u7d30\u53ef\u4ee5\u770b\u6587\u4ef6"),(0,o.kt)("h3",{id:"re-render-component-to-find-bugs-and-fixed"},"Re-render component to find bugs and fixed"),(0,o.kt)("p",null,"\u6211\u5011\u5728 App.js \u88e1\u9762\u5efa\u7acb\u4e00\u500b array \uff0c\u4e26\u4e14\u5c07 array \u50b3\u7d66 ",(0,o.kt)("inlineCode",{parentName:"p"},"<StoryTray />")," \uff0c\u800c StoryTray \u6703 render \u50b3\u4e0b\u4f86\u7684 array\uff0c\u4e26\u4e14\u5728 component \u5167\uff0c\u5728 array \u6700\u5f8c\u52a0\u4e86\u4e00\u500b ",(0,o.kt)("inlineCode",{parentName:"p"},"Create Story")," \u7684\u9805\u76ee\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live noInline",live:!0,noInline:!0},'const App = () => {\n  let [stories, setStories] = useState([\n    {id: 0, label: "Ankit\'s Story"},\n    {id: 1, label: "Taylor\'s Story"},\n  ]);\n  return (\n    <div>\n      <StoryTray stories={stories} />\n    </div>\n  );\n};\n\nconst StoryTray = ({stories}) => {\n  const items = stories;\n  items.push({id: "create", label: "Create Story"});\n  return (\n    <ul>\n      {items.map((story) => (\n        <li key={story.id}>{story.label}</li>\n      ))}\n    </ul>\n  );\n};\n\nrender(<App />);\n')),(0,o.kt)("p",null,"\u76ee\u524d\u770b\u8d77\u4f86\u90fd\u6c92\u4ec0\u9ebc\u554f\u984c\uff0c\u4f46\u6211\u5011\u7684\u9700\u6c42\u4f86\u4e86"),(0,o.kt)("p",null,"\u73fe\u5728\u6709\u4e00\u500b\u9700\u6c42\uff0c\u671f\u671b\u5728 hover \u7684\u6642\u5019\uff0c\u52a0\u5165 css \u7684 style\n\u6211\u5011\u7528\u4e86 isHover \u53bb\u5224\u65b7\u662f\u5426\u6709 hover \u5230 ul \uff0c\u4e26\u4e14\u7d66\u4e88 css \u7684 style"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="StoryTray with Hover future" {4,8-14}',title:'"StoryTray',with:!0,Hover:!0,'future"':!0,"{4,8-14}":!0},'import {useState} from "react";\n\nconst function StoryTray({stories}) {\n  const [isHover, setIsHover] = useState(false);\n  const items = stories;\n  items.push({id: "create", label: "Create Story"});\n  return (\n    <ul\n      onPointerEnter={() => setIsHover(true)}\n      onPointerLeave={() => setIsHover(false)}\n      style={{\n        backgroundColor: isHover ? "#ddd" : "#fff",\n      }}\n    >\n      {items.map((story) => (\n        <li key={story.id}>{story.label}</li>\n      ))}\n    </ul>\n  );\n}\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live noInline",live:!0,noInline:!0},'const App = () => {\n  let [stories, setStories] = useState([\n    {id: 0, label: "Ankit\'s Story"},\n    {id: 1, label: "Taylor\'s Story"},\n  ]);\n  return (\n    <div>\n      <StoryTray stories={stories} />\n    </div>\n  );\n};\n\nconst StoryTray = ({stories}) => {\n  const [isHover, setIsHover] = useState(false);\n  const items = stories;\n  items.push({id: "create", label: "Create Story"});\n  return (\n    <ul\n      onPointerEnter={() => setIsHover(true)}\n      onPointerLeave={() => setIsHover(false)}\n      style={{\n        backgroundColor: isHover ? "#ddd" : "#fff",\n      }}\n    >\n      {items.map((story) => (\n        <li key={story.id}>{story.label}</li>\n      ))}\n    </ul>\n  );\n};\n\nrender(<App />);\n')),(0,o.kt)("p",null,"\u5728 ",(0,o.kt)("inlineCode",{parentName:"p"},"\u6c92\u6709")," StrictMode \u7684\u60c5\u6cc1\u4e0b\uff0c\u6211\u5011\u9700\u8981 Hover \u624d\u6703\u767c\u73fe\u5230\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},'items.push({id: "create", label: "Create Story"});')," \u9019\u884c\u6703\u5728 hover \u6642\u88ab\u89f8\u767c\uff0c\u9020\u6210\u9801\u9762\u986f\u793a\u4e0d\u6b63\u78ba"),(0,o.kt)("p",null,"\u4f46\u662f\u7576\u6211\u5011\u52a0\u5165 ",(0,o.kt)("inlineCode",{parentName:"p"},"StrictMode")," \uff0c\u6211\u5011\u53ef\u4ee5\u5728\u9084\u6c92 Hover \u6642\u767c\u73fe ",(0,o.kt)("inlineCode",{parentName:"p"},"Create Story")," \u6709\u5169\u500b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="Add StrictMode" {4,6}',title:'"Add','StrictMode"':!0,"{4,6}":!0},"const App = () => {\n  // ...\n  return (\n    <StrictMode>\n      <StoryTray stories={stories} />\n    </StrictMode>\n  );\n};\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live noInline",live:!0,noInline:!0},'const App = () => {\n  let [stories, setStories] = useState([\n    {id: 0, label: "Ankit\'s Story"},\n    {id: 1, label: "Taylor\'s Story"},\n  ]);\n  return (\n    <StrictMode>\n      <StoryTray stories={stories} />\n    </StrictMode>\n  );\n};\n\nconst StoryTray = ({stories}) => {\n  const [isHover, setIsHover] = useState(false);\n  const items = stories;\n  items.push({id: "create", label: "Create Story"});\n  return (\n    <ul\n      onPointerEnter={() => setIsHover(true)}\n      onPointerLeave={() => setIsHover(false)}\n      style={{\n        backgroundColor: isHover ? "#ddd" : "#fff",\n      }}\n    >\n      {items.map((story) => (\n        <li key={story.id}>{story.label}</li>\n      ))}\n    </ul>\n  );\n};\n\nrender(<App />);\n')),(0,o.kt)("p",null,"\u56e0\u70ba\u52a0\u5165 StrictMode \u7684\u95dc\u4fc2\uff0c\u6703\u591a re-render \u4e00\u6b21 component \uff0c\u5c31\u80fd\u5728 render \u5b8c\u99ac\u4e0a\u767c\u73fe\u756b\u9762\u7684\u4e0d\u6b63\u78ba\uff0c\u53ef\u4ee5\u6709\u6548\u907f\u514d render \u6642 side effect \u7684\u64cd\u4f5c\u3002"),(0,o.kt)("p",null,"\u6587\u7ae0\u5167\u6709\u63d0\u5230\uff0c\u8981\u89e3\u6c7a\u7684\u65b9\u5f0f\u662f\u8981\u628a props \u7684\u53c3\u6578\u6dfa\u62f7\u8c9d\u4e00\u4efd\u5f8c\u518d\u505a\u64cd\u4f5c\uff0c\u5c31\u53ef\u4ee5\u907f\u514d\u6b64\u73fe\u8c61\u767c\u751f\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"{2}","{2}":!0},"export default function StoryTray({ stories }) {\n  const items = stories.slice(); // Clone the array, pushing into a new array\n  items.push({ id: 'create', label: 'Create Story' });\n")),(0,o.kt)("h3",{id:"re-run-effect-to-find-bugs-and-fixed"},"Re-run effect to find bugs and fixed"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"\u4ee5\u4e0b\u7bc4\u4f8b\u5efa\u8b70\u958b\u555f\u958b\u767c\u8005\u6a21\u5f0f\u770b console.log \u7684\u8b8a\u5316")),(0,o.kt)("p",null,"\u6211\u5011\u8981\u5efa\u7acb\u4e00\u500b chatroom \uff0c\u6240\u4ee5\u671f\u671b\u5728 app \u9032\u4f86\u6642\uff0c\u53ef\u4ee5\u8ddf\u5f8c\u7aef\u505a connect\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live noInline",live:!0,noInline:!0},'const serverUrl = "https://localhost:1234";\nconst roomId = "general";\n\nfunction App() {\n  useEffect(() => {\n    const connection = createConnection(serverUrl, roomId);\n    connection.connect();\n  }, []);\n  return <h1>Welcome to the {roomId} room!</h1>;\n}\n\nlet connections = 0;\n\nfunction createConnection(serverUrl, roomId) {\n  // A real implementation would actually connect to the server\n  return {\n    connect() {\n      console.log(\n        \'\u2705 Demo 1  Connecting to "\' + roomId + \'" room at \' + serverUrl + "..."\n      );\n      connections++;\n      console.log("Demo 1 Active connections: " + connections);\n    },\n    disconnect() {\n      console.log(\n        \'\u274c Demo 1 Disconnected from "\' + roomId + \'" room at \' + serverUrl\n      );\n      connections--;\n      console.log("Demo 1  Active connections: " + connections);\n    },\n  };\n}\n\nrender(<App />);\n')),(0,o.kt)("p",null,"\u4e0a\u9762\u7684\u7bc4\u4f8b\u770b\u8d77\u4f86\u6c92\u4ec0\u9ebc\u554f\u984c\uff0c\u5728 App \u521d\u59cb\u5316\u7684\u6642\u5019\u53bb connection \u9023\u7dda\uff0c\u4f46\u662f\u7576\u4eca\u5929\u7684\u9700\u6c42\u51fa\u73fe\uff0c\u6211\u5011\u53ef\u80fd\u6703\u52d5\u614b\u6539\u8b8a room Id \u7684\u8a71\uff0c\u4e0a\u9762\u7684\u5beb\u6cd5\u5c31\u6703\u51fa\u73fe\u554f\u984c\u4e86\u3002"),(0,o.kt)("p",null,"\u6211\u5011\u52a0\u5165\u5207\u63db roomId \u7684 select\uff0c\u7576 select \u8b8a\u52d5\u6642\uff0c\u6703\u91cd\u65b0\u53bb\u9023\u7dda\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:"live noInline",live:!0,noInline:!0},'const serverUrl = "https://localhost:1234";\n\nfunction ChatRoom({roomId}) {\n  useEffect(() => {\n    const connection = createConnection(serverUrl, roomId);\n    connection.connect();\n  }, [roomId]);\n\n  return <h1>Welcome to the {roomId} room!</h1>;\n}\n\nlet connections = 0;\n\nfunction App() {\n  const [roomId, setRoomId] = useState("general");\n  const [show, setShow] = useState(false);\n  return (\n    <>\n      <label>\n        Choose the chat room:{" "}\n        <select value={roomId} onChange={(e) => setRoomId(e.target.value)}>\n          <option value="general">general</option>\n          <option value="travel">travel</option>\n          <option value="music">music</option>\n        </select>\n      </label>\n      <button onClick={() => setShow(!show)}>\n        {show ? "Close chat" : "Open chat"}\n      </button>\n      {show && <hr />}\n      {show && <ChatRoom roomId={roomId} />}\n    </>\n  );\n}\n\nfunction createConnection(serverUrl, roomId) {\n  // A real implementation would actually connect to the server\n  return {\n    connect() {\n      console.log(\n        \'\u2705Demo 2 Connecting to "\' + roomId + \'" room at \' + serverUrl + "..."\n      );\n      connections++;\n      console.log("Demo 2 Active connections: " + connections);\n    },\n    disconnect() {\n      console.log(\n        \'\u274c Demo 2 Disconnected from "\' + roomId + \'" room at \' + serverUrl\n      );\n      connections--;\n      console.log("Demo 2 Active connections: " + connections);\n    },\n  };\n}\n\nrender(<App />);\n')),(0,o.kt)("p",null,"\u6703\u767c\u73fe\uff0c\u7576\u5207\u63db\u6642\uff0c\u4e0d\u65b7\u8df3 connect \u7684 console \uff0c\u4f46\u662f\u6c92\u6709 disconnect \uff0c\u4ee3\u8868\u6bcf\u6b21\u7684\u9023\u7dda\u90fd\u6c92\u6709\u628a\u820a\u7684\u9023\u7dda\u6e05\u6389\uff0c\u4e26\u4e14\u4e00\u76f4\u65b0\u589e\u9023\u7dda\uff0c\u9019\u6703\u9020\u6210\u5f8c\u7aef\u7684\u8ca0\u64d4\u592a\u5927\uff0c\u56e0\u70ba\u6703\u6709\u8a31\u591a\u6c92\u5728\u7528\u7684\u9023\u7dda\u4e00\u76f4\u5728\u80cc\u666f\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"demo2 multiple connect",src:n(9477).Z,width:"622",height:"129"})),(0,o.kt)("p",null,"\u7576\u6211\u5011\u4e00\u6a23\u628a StrictMode \u52a0\u5728 App \u5916\u9762\u6642\uff0c\u6703\u767c\u73fe\u5728\u7b2c\u4e00\u6b21\u9032\u4f86\u6642\uff0c\u5c31\u6703\u770b\u5230 connect \u88ab\u89f8\u767c\u5169\u6b21\uff0c\u4ee3\u8868\u4ed6 re-run \u4e86 useEffect \uff0c\u53bb\u6aa2\u67e5 effect \u88e1\u9762\u7684 callback \u662f\u5426\u662f pure \u7684\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"demo1 in StrictMode",src:n(7129).Z,width:"590",height:"129"})),(0,o.kt)("p",null,"\u8981\u89e3\u6c7a\u4ee5\u4e0a\u7684\u65b9\u5f0f\u5c31\u662f\uff0c\u8981\u5728 useEffect \u7684 return \u53bb\u57f7\u884c disconnect \uff0c\u7576\u9023\u7dda\u6539\u8b8a\u6642\uff0c\u6703\u5148\u65b7\u6389\u4e0a\u4e00\u500b\u9023\u7dda\u624d\u6703\u9032\u884c\u65b0\u7684\u9023\u7dda\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="Solution" {4}',title:'"Solution"',"{4}":!0},"useEffect(() => {\n  const connection = createConnection(serverUrl, roomId);\n  connection.connect();\n  return () => connection.disconnect();\n}, [roomId]);\n")),(0,o.kt)("h3",{id:"find-deprecation-warnings-enabled"},"Find deprecation warnings enabled"),(0,o.kt)("p",null,"\u5982\u679c\u6709\u4f7f\u7528\u5230\u5df2\u7d93\u68c4\u7528\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"component")," \u6216\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"function")," \u6642\uff0c\u6703\u5728 console \u6709 warning \uff0c\u53ef\u4ee5\u907f\u514d\u7dda\u4e0a\u7684\u529f\u80fd\u53d7\u5230\u7248\u672c\u5f71\u97ff\u4e0d\u80fd\u4f7f\u7528\u7684\u554f\u984c\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"deprecated",src:n(386).Z,width:"624",height:"117"})),(0,o.kt)("h2",{id:"\u89e3\u6c7a-useeffect-\u6703-call-\u5169\u6b21-api-\u7684\u554f\u984c"},"\u89e3\u6c7a useEffect \u6703 call \u5169\u6b21 API \u7684\u554f\u984c"),(0,o.kt)("p",null,"\u56de\u5230\u6700\u6e90\u982d\uff0cStrictMode \u6709\u4ee5\u4e0a\u7279\u6027\uff0c\u90a3\u5c31\u8981\u89e3\u6c7a\u6211\u5728\u958b\u767c\u6642\uff0c\u5728 useEffect call \u5169\u6b21 API \u7684\u554f\u984c"),(0,o.kt)("p",null,"\u9019\u908a\u63d0\u4f9b\u4e00\u4e9b\u6211\u53c3\u8003\u4e26\u5be6\u4f5c\uff0c\u53ef\u4ee5\u89e3\u6c7a\u6b64\u554f\u984c\u7684\u65b9\u5f0f"),(0,o.kt)("h3",{id:"remove-strictmode"},"Remove StrictMode"),(0,o.kt)("p",null,"\u6700\u5feb\u7684\u65b9\u5f0f\u5c31\u662f\uff0c\u79fb\u9664 StrictMode \u7684 component \uff0c\u56e0\u70ba\u79fb\u9664\u4e5f\u4e0d\u5f71\u97ff\u958b\u767c\uff0c\u4e3b\u8981\u662f\u5728 debug \u6642\u6703\u6bd4\u8f03\u9700\u8981\u6e2c\u8a66\u8f03\u591a\u6848\u4f8b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="\u79fb\u9664 StrictMode"',title:'"\u79fb\u9664','StrictMode"':!0},'import {createRoot} from "react-dom/client";\n\nconst root = createRoot(document.getElementById("root"));\nroot.render(<App />);\n')),(0,o.kt)("h3",{id:"use-abortcontroller"},"Use AbortController"),(0,o.kt)("p",null,"\u4f7f\u7528 ",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/zh-TW/docs/Web/API/AbortController"},"AbortController")," \uff0c\u9019\u662f\u4e00\u500b\u5be6\u9a57\u4e2d\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u5728\u9700\u8981\u7684\u6642\u5019\u4e2d\u65b7\u8acb\u6c42\uff0c\u4ee5\u4e0b\u9762\u7684\u6848\u4f8b\u4e2d\uff0c\u6211\u5011\u5728 useEffect \u7684 return \u53bb\u4e2d\u6b62\u9019\u500b API \uff0c\u907f\u514d\u5728\u7b2c\u4e8c\u6b21 re-run \u6642\uff0c\u518d\u767c\u4e00\u6b21 API"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="AbortController"',title:'"AbortController"'},'import React, {useState, useEffect} from "react";\n\nconst Demo = () => {\n  const [response, setResponse] = useState({});\n\n  useEffect(() => {\n    const controller = new AbortController();\n    fetch("your api end point", {\n      signal: controller.signal,\n    })\n      .then((res) => res.json())\n      .then(setResponse);\n    return () => controller.abort();\n  }, []);\n\n  return <div>test api post</div>;\n};\n\nexport default Demo;\n')),(0,o.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u900f\u904e AbortController \u53ef\u4ee5\u907f\u514d\u7b2c\u4e8c\u6b21 API \u767c\u51fa\u53bb\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"aboutController",src:n(3757).Z,width:"629",height:"362"})),(0,o.kt)("h3",{id:"use-react-query"},"Use React-Query"),(0,o.kt)("p",null,"\u53ef\u4ee5\u4f7f\u7528 react-query \u9019\u500b library \u8655\u7406 api \u7684 get/post\uff0c\u9664\u4e86\u53ef\u4ee5\u907f\u514d\u6253\u5169\u6b21 API \u5916\uff0c\u4e5f\u63d0\u4f9b\u8a31\u591a api \u72c0\u614b\u7684\u53c3\u6578\u4f9b\u9801\u9762\u4f7f\u7528\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="react-query demo"',title:'"react-query','demo"':!0},'import React from "react";\nimport {useQuery} from "react-query";\nconst Demo = () => {\n  const {isLoading, error, data} = useQuery("api", () =>\n    fetch("your api end point").then((res) => res.json())\n  );\n\n  console.log(data);\n\n  return <div>1234</div>;\n};\n\nexport default Demo;\n')))}u.isMDXComponent=!0},3757:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/abortController-4a0bf50263c19d7398d5f98b1f36da76.png"},7129:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/demo1-in-strict-mode-67f24c458786bd786e9f98e707ee7728.png"},9477:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/demo2-440d7c1f4d03f923a256286a1704b430.png"},386:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/deprecated-a2919d4e3c5182ba57fa448af20bba31.png"}}]);